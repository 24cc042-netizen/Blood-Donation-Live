{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState } from 'react';\nimport StatusBar from \"react-native-web/dist/exports/StatusBar\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\nimport RoleSelect from \"./app/(auth)/RoleSelect\";\nimport PhoneAuth from \"./app/(auth)/PhoneAuth\";\nimport ProfileSetup from \"./app/(auth)/ProfileSetup\";\nimport MainTabs from \"./app/(tabs)/_layout\";\nimport useAuth from \"./hooks/useAuth\";\nimport { fetchAllInstitutions } from \"./lib/firebase\";\nimport { saveInstitutionsCache } from \"./lib/offlineCache\";\nimport NetInfo from '@react-native-community/netinfo';\nimport * as Notifications from 'expo-notifications';\nimport { saveFcmTokenForUser, auth as firebaseAuth } from \"./lib/firebase\";\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nvar Stack = createNativeStackNavigator();\nexport default function App() {\n  var _useAuth = useAuth(),\n    user = _useAuth.user,\n    loading = _useAuth.loading;\n  var _useState = useState(true),\n    _useState2 = _slicedToArray(_useState, 2),\n    initLoading = _useState2[0],\n    setInitLoading = _useState2[1];\n  useEffect(function () {\n    function seed() {\n      return _seed.apply(this, arguments);\n    }\n    function _seed() {\n      _seed = _asyncToGenerator(function* () {\n        try {\n          var net = yield NetInfo.fetch();\n          if (net.isConnected) {\n            var inst = yield fetchAllInstitutions();\n            if (inst && inst.length) yield saveInstitutionsCache(inst);\n            try {\n              var _yield$Notifications$ = yield Notifications.getPermissionsAsync(),\n                existing = _yield$Notifications$.status;\n              var finalStatus = existing;\n              if (existing !== 'granted') {\n                var _yield$Notifications$2 = yield Notifications.requestPermissionsAsync(),\n                  status = _yield$Notifications$2.status;\n                finalStatus = status;\n              }\n              if (finalStatus === 'granted') {\n                var tokenData = yield Notifications.getExpoPushTokenAsync();\n                var token = tokenData.data;\n                var uid = firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : null;\n                if (uid) yield saveFcmTokenForUser(uid, token);\n              }\n            } catch (e) {\n              console.warn('Push token flow failed', e);\n            }\n          }\n        } catch (e) {\n          console.warn('Seed institutions failed', e);\n        } finally {\n          setInitLoading(false);\n        }\n      });\n      return _seed.apply(this, arguments);\n    }\n    seed();\n  }, []);\n  if (loading || initLoading) {\n    return _jsxs(View, {\n      style: {\n        flex: 1,\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      children: [_jsx(ActivityIndicator, {\n        size: \"large\",\n        color: \"#ef4444\"\n      }), _jsx(Text, {\n        style: {\n          marginTop: 12\n        },\n        children: \"Loading BloodConnect\\u2026\"\n      })]\n    });\n  }\n  return _jsxs(NavigationContainer, {\n    children: [_jsx(StatusBar, {\n      barStyle: \"dark-content\"\n    }), _jsx(Stack.Navigator, {\n      screenOptions: {\n        headerShown: false\n      },\n      children: !user ? _jsxs(_Fragment, {\n        children: [_jsx(Stack.Screen, {\n          name: \"RoleSelect\",\n          component: RoleSelect\n        }), _jsx(Stack.Screen, {\n          name: \"PhoneAuth\",\n          component: PhoneAuth\n        }), _jsx(Stack.Screen, {\n          name: \"ProfileSetup\",\n          component: ProfileSetup\n        })]\n      }) : _jsx(Stack.Screen, {\n        name: \"MainTabs\",\n        component: MainTabs,\n        initialParams: {\n          role: 'user'\n        }\n      })\n    })]\n  });\n}","map":{"version":3,"names":["React","useEffect","useState","StatusBar","View","ActivityIndicator","Text","NavigationContainer","createNativeStackNavigator","RoleSelect","PhoneAuth","ProfileSetup","MainTabs","useAuth","fetchAllInstitutions","saveInstitutionsCache","NetInfo","Notifications","saveFcmTokenForUser","auth","firebaseAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Stack","App","_useAuth","user","loading","_useState","_useState2","_slicedToArray","initLoading","setInitLoading","seed","_seed","apply","arguments","_asyncToGenerator","net","fetch","isConnected","inst","length","_yield$Notifications$","getPermissionsAsync","existing","status","finalStatus","_yield$Notifications$2","requestPermissionsAsync","tokenData","getExpoPushTokenAsync","token","data","uid","currentUser","e","console","warn","style","flex","justifyContent","alignItems","children","size","color","marginTop","barStyle","Navigator","screenOptions","headerShown","Screen","name","component","initialParams","role"],"sources":["/workspaces/Blood-Donation-Live/App.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { StatusBar, View, ActivityIndicator, Text } from 'react-native';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createNativeStackNavigator } from '@react-navigation/native-stack';\nimport RoleSelect from './app/(auth)/RoleSelect';\nimport PhoneAuth from './app/(auth)/PhoneAuth';\nimport ProfileSetup from './app/(auth)/ProfileSetup';\nimport MainTabs from './app/(tabs)/_layout';\nimport useAuth from './hooks/useAuth';\nimport { fetchAllInstitutions } from './lib/firebase';\nimport { saveInstitutionsCache, getInstitutionsCache } from './lib/offlineCache';\nimport NetInfo from '@react-native-community/netinfo';\nimport * as Notifications from 'expo-notifications';\nimport { saveFcmTokenForUser, auth as firebaseAuth } from './lib/firebase';\n\nconst Stack = createNativeStackNavigator();\n\nexport default function App() {\n  const { user, loading } = useAuth();\n  const [initLoading, setInitLoading] = useState(true);\n\n  useEffect(() => {\n    // On first app load with internet, fetch & cache institutions for offline use.\n    async function seed() {\n      try {\n        const net = await NetInfo.fetch();\n        if (net.isConnected) {\n          const inst = await fetchAllInstitutions();\n          if (inst && inst.length) await saveInstitutionsCache(inst);\n          // also request push permission and save token for authenticated user\n          try {\n            const { status: existing } = await Notifications.getPermissionsAsync();\n            let finalStatus = existing;\n            if (existing !== 'granted') {\n              const { status } = await Notifications.requestPermissionsAsync();\n              finalStatus = status;\n            }\n            if (finalStatus === 'granted') {\n              const tokenData = await Notifications.getExpoPushTokenAsync();\n              const token = tokenData.data;\n              const uid = firebaseAuth.currentUser ? firebaseAuth.currentUser.uid : null;\n              if (uid) await saveFcmTokenForUser(uid, token);\n            }\n          } catch (e) { console.warn('Push token flow failed', e); }\n        }\n      } catch (e) {\n        console.warn('Seed institutions failed', e);\n      } finally {\n        setInitLoading(false);\n      }\n    }\n    seed();\n  }, []);\n\n  if (loading || initLoading) {\n    return (\n      <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\n        <ActivityIndicator size=\"large\" color=\"#ef4444\" />\n        <Text style={{ marginTop: 12 }}>Loading BloodConnectâ€¦</Text>\n      </View>\n    );\n  }\n\n  return (\n    <NavigationContainer>\n      <StatusBar barStyle=\"dark-content\" />\n      <Stack.Navigator screenOptions={{ headerShown: false }}>\n        {!user ? (\n          // Auth flow\n          <>\n            <Stack.Screen name=\"RoleSelect\" component={RoleSelect} />\n            <Stack.Screen name=\"PhoneAuth\" component={PhoneAuth} />\n            <Stack.Screen name=\"ProfileSetup\" component={ProfileSetup} />\n          </>\n        ) : (\n          // Main tabs. Pass role via user profile in real app.\n          <Stack.Screen name=\"MainTabs\" component={MainTabs} initialParams={{ role: 'user' }} />\n        )}\n      </Stack.Navigator>\n    </NavigationContainer>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}