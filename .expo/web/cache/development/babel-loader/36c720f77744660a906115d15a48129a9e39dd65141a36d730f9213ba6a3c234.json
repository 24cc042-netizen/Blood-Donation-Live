{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { db } from \"../../lib/firebase\";\nimport { doc, setDoc, collection, addDoc } from 'firebase/firestore';\nimport { auth } from \"../../lib/firebase\";\nimport * as Location from 'expo-location';\nimport { jsxs as _jsxs, jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nexport default function ProfileSetup(_ref) {\n  var route = _ref.route,\n    navigation = _ref.navigation;\n  var _ref2 = route.params || {\n      role: 'user'\n    },\n    role = _ref2.role,\n    uid = _ref2.uid;\n  var _useState = useState(''),\n    _useState2 = _slicedToArray(_useState, 2),\n    fullName = _useState2[0],\n    setFullName = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    email = _useState4[0],\n    setEmail = _useState4[1];\n  var _useState5 = useState('O+'),\n    _useState6 = _slicedToArray(_useState5, 2),\n    bloodType = _useState6[0],\n    setBloodType = _useState6[1];\n  var _useState7 = useState(''),\n    _useState8 = _slicedToArray(_useState7, 2),\n    instName = _useState8[0],\n    setInstName = _useState8[1];\n  var _useState9 = useState(''),\n    _useState0 = _slicedToArray(_useState9, 2),\n    licenseId = _useState0[0],\n    setLicenseId = _useState0[1];\n  function saveProfile() {\n    return _saveProfile.apply(this, arguments);\n  }\n  function _saveProfile() {\n    _saveProfile = _asyncToGenerator(function* () {\n      try {\n        var currentUid = uid || (auth.currentUser ? auth.currentUser.uid : null);\n        if (!currentUid) throw new Error('User not signed in');\n        var _yield$Location$getCu = yield Location.getCurrentPositionAsync({}),\n          coords = _yield$Location$getCu.coords;\n        if (role === 'user') {\n          var userDoc = doc(db, 'users', currentUid);\n          yield setDoc(userDoc, {\n            fullName: fullName,\n            email: email,\n            bloodType: bloodType,\n            role: role,\n            location: {\n              latitude: coords.latitude,\n              longitude: coords.longitude\n            },\n            isAvailableToDonate: true,\n            lastDonationDate: null\n          });\n          Alert.alert('Saved', 'Profile saved.');\n          navigation.replace('MainTabs', {\n            role: role\n          });\n          return;\n        }\n        var instRef = collection(db, 'institutions');\n        var data = {\n          name: instName,\n          verificationId: licenseId,\n          contactEmail: email,\n          contactPhone: auth.currentUser ? auth.currentUser.phoneNumber : '',\n          address: '',\n          location: {\n            latitude: coords.latitude,\n            longitude: coords.longitude\n          },\n          isVerified: false,\n          type: role,\n          ownerUid: currentUid\n        };\n        var docRef = yield addDoc(instRef, data);\n        yield setDoc(doc(db, 'users', currentUid), {\n          fullName: fullName,\n          email: email,\n          role: role,\n          ownerOf: docRef.id\n        });\n        Alert.alert('Registered', 'Institution registered. Await verification.');\n        navigation.replace('MainTabs', {\n          role: role\n        });\n      } catch (err) {\n        console.warn('Profile save failed', err);\n        Alert.alert('Error', err.message || 'Failed to save profile');\n      }\n    });\n    return _saveProfile.apply(this, arguments);\n  }\n  return _jsxs(View, {\n    style: {\n      flex: 1,\n      padding: 16\n    },\n    children: [_jsxs(Text, {\n      style: {\n        fontSize: 18,\n        marginBottom: 12\n      },\n      children: [\"Complete your profile (\", role, \")\"]\n    }), _jsx(TextInput, {\n      placeholder: \"Full name\",\n      value: fullName,\n      onChangeText: setFullName,\n      style: {\n        borderWidth: 1,\n        padding: 10,\n        marginBottom: 12\n      }\n    }), _jsx(TextInput, {\n      placeholder: \"Email\",\n      value: email,\n      onChangeText: setEmail,\n      style: {\n        borderWidth: 1,\n        padding: 10,\n        marginBottom: 12\n      }\n    }), role === 'user' ? _jsx(TextInput, {\n      placeholder: \"Blood Type\",\n      value: bloodType,\n      onChangeText: setBloodType,\n      style: {\n        borderWidth: 1,\n        padding: 10,\n        marginBottom: 12\n      }\n    }) : _jsxs(_Fragment, {\n      children: [_jsx(TextInput, {\n        placeholder: \"Institution Name\",\n        value: instName,\n        onChangeText: setInstName,\n        style: {\n          borderWidth: 1,\n          padding: 10,\n          marginBottom: 12\n        }\n      }), _jsx(TextInput, {\n        placeholder: \"License / Registration ID\",\n        value: licenseId,\n        onChangeText: setLicenseId,\n        style: {\n          borderWidth: 1,\n          padding: 10,\n          marginBottom: 12\n        }\n      })]\n    }), _jsx(Button, {\n      title: \"Save\",\n      onPress: saveProfile\n    })]\n  });\n}","map":{"version":3,"names":["React","useState","View","Text","TextInput","Button","Alert","db","doc","setDoc","collection","addDoc","auth","Location","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","ProfileSetup","_ref","route","navigation","_ref2","params","role","uid","_useState","_useState2","_slicedToArray","fullName","setFullName","_useState3","_useState4","email","setEmail","_useState5","_useState6","bloodType","setBloodType","_useState7","_useState8","instName","setInstName","_useState9","_useState0","licenseId","setLicenseId","saveProfile","_saveProfile","apply","arguments","_asyncToGenerator","currentUid","currentUser","Error","_yield$Location$getCu","getCurrentPositionAsync","coords","userDoc","location","latitude","longitude","isAvailableToDonate","lastDonationDate","alert","replace","instRef","data","name","verificationId","contactEmail","contactPhone","phoneNumber","address","isVerified","type","ownerUid","docRef","ownerOf","id","err","console","warn","message","style","flex","padding","children","fontSize","marginBottom","placeholder","value","onChangeText","borderWidth","title","onPress"],"sources":["/workspaces/Blood-Donation-Live/app/(auth)/ProfileSetup.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { View, Text, TextInput, Button, Alert } from 'react-native';\nimport { db } from '../../lib/firebase';\nimport { doc, setDoc, collection, addDoc, query, where, getDocs } from 'firebase/firestore';\nimport { auth } from '../../lib/firebase';\nimport * as Location from 'expo-location';\n\nexport default function ProfileSetup({ route, navigation }: any) {\n  const { role, uid } = route.params || { role: 'user' };\n  const [fullName, setFullName] = useState('');\n  const [email, setEmail] = useState('');\n  const [bloodType, setBloodType] = useState('O+');\n  const [instName, setInstName] = useState('');\n  const [licenseId, setLicenseId] = useState('');\n\n  async function saveProfile() {\n    try {\n      // Use provided uid (from OTP confirm) or current auth user\n      const currentUid = uid || (auth.currentUser ? auth.currentUser.uid : null);\n      if (!currentUid) throw new Error('User not signed in');\n\n      const { coords } = await Location.getCurrentPositionAsync({});\n\n      if (role === 'user') {\n        const userDoc = doc(db, 'users', currentUid);\n        await setDoc(userDoc, {\n          fullName,\n          email,\n          bloodType,\n          role,\n          location: { latitude: coords.latitude, longitude: coords.longitude },\n          isAvailableToDonate: true,\n          lastDonationDate: null\n        });\n        Alert.alert('Saved', 'Profile saved.');\n        navigation.replace('MainTabs', { role });\n        return;\n      }\n\n      // Institution registration (hospital, bank, lab)\n      const instRef = collection(db, 'institutions');\n      const data = {\n        name: instName,\n        verificationId: licenseId,\n        contactEmail: email,\n        contactPhone: auth.currentUser ? auth.currentUser.phoneNumber : '',\n        address: '',\n        location: { latitude: coords.latitude, longitude: coords.longitude },\n        isVerified: false,\n        type: role,\n        ownerUid: currentUid\n      };\n      const docRef = await addDoc(instRef, data);\n      // create a minimal users/{uid} entry as well\n      await setDoc(doc(db, 'users', currentUid), { fullName, email, role, ownerOf: docRef.id });\n      Alert.alert('Registered', 'Institution registered. Await verification.');\n      navigation.replace('MainTabs', { role });\n    } catch (err: any) {\n      console.warn('Profile save failed', err);\n      Alert.alert('Error', err.message || 'Failed to save profile');\n    }\n  }\n\n  return (\n    <View style={{ flex: 1, padding: 16 }}>\n      <Text style={{ fontSize: 18, marginBottom: 12 }}>Complete your profile ({role})</Text>\n      <TextInput placeholder=\"Full name\" value={fullName} onChangeText={setFullName} style={{ borderWidth: 1, padding: 10, marginBottom: 12 }} />\n      <TextInput placeholder=\"Email\" value={email} onChangeText={setEmail} style={{ borderWidth: 1, padding: 10, marginBottom: 12 }} />\n      {role === 'user' ? (\n        <TextInput placeholder=\"Blood Type\" value={bloodType} onChangeText={setBloodType} style={{ borderWidth: 1, padding: 10, marginBottom: 12 }} />\n      ) : (\n        <>\n          <TextInput placeholder=\"Institution Name\" value={instName} onChangeText={setInstName} style={{ borderWidth: 1, padding: 10, marginBottom: 12 }} />\n          <TextInput placeholder=\"License / Registration ID\" value={licenseId} onChangeText={setLicenseId} style={{ borderWidth: 1, padding: 10, marginBottom: 12 }} />\n        </>\n      )}\n      <Button title=\"Save\" onPress={saveProfile} />\n    </View>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}